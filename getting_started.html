
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Getting started &#8212; GPEC 1.0.5 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Outputs and Post-Processing" href="outputs.html" />
    <link rel="prev" title="Indices and tables" href="index.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="outputs.html" title="Outputs and Post-Processing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Indices and tables"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting started</a><ul>
<li><a class="reference internal" href="#gpec-user-agreement">GPEC User Agreement</a></li>
<li><a class="reference internal" href="#install">Install</a></li>
<li><a class="reference internal" href="#run-process">Run Process</a></li>
<li><a class="reference internal" href="#a-word-on-coordinates">A Word On Coordinates</a></li>
<li><a class="reference internal" href="#inputs">Inputs</a></li>
<li><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Indices and tables</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="outputs.html"
                        title="next chapter">Outputs and Post-Processing</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/getting_started.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This section provides the basic structure of the GPEC code and the processes necessary to run it. Although it is not a tutorial, the user should be able to run a sample of the code after reading this chapter.</p>
<div class="section" id="gpec-user-agreement">
<span id="installing"></span><h2>GPEC User Agreement<a class="headerlink" href="#gpec-user-agreement" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2016.03.18</td>
</tr>
</tbody>
</table>
<p>GPEC development is funded by the US Department of Energy (DoE) through the Princeton Plasma Physics Laboratory (PPPL), and distribution is subject to DoE and PPPL requirements and restrictions.</p>
<p>The scientific results from the use of GPEC are intended for publication and sharing in the open scientific community.</p>
<p>In order to acquire access to the code sources and/or executables, the user must agree to the following:</p>
<ol class="arabic simple">
<li>The user will not rename, modify or redistribute the code, in whole or in part, to 3rd parties without consent of the authors, although the code may be imbedded unmodified and shared within a larger software project.</li>
<li>If modifications or improvements are needed, these will be developed in collaboration with the authors, so that they may be redistributed through the GPEC git versioning distributions to the benefit of all GPEC users.</li>
<li>The users will include the proper code name(s) and appropriate references in published results and presentations. The will must email a draft of any article/report/presentation/etc. using GPEC results to the authors prior to publishing.</li>
</ol>
</div>
<div class="section" id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<p>Public installations should be downloaded and kept up to date from the <a class="reference external" href="https://github.com/PrincetonUniversity/GPEC">releases on Github</a>. The releases remain private for now, so only those with access to the repository will be able to install/update the site package. Contact <a class="reference external" href="mailto:nlogan&#37;&#52;&#48;pppl&#46;gov">nlogan<span>&#64;</span>pppl<span>&#46;</span>gov</a> for access.</p>
<p>The global makefile can be found in the install directory. This essentially enters and makes each individual subdirectory. Each subdirectory’s makefile references the DEFAULTS.inc file, also in install. A basic compiling is as simple as executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>in the install directory. The executables will then be available in their individual subdirectories as well as collected in the bin directory.</p>
<p>The DEFAULTS.inc sets a number of variables based on conditionals that determine the architecture on which GPEC is being compiled. If you are installing in a new or recently changed environment these can be over-ridden at the individual level. For example, at PPPL this might be done in pentrc using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">FC</span><span class="o">=</span><span class="n">lfc</span>
</pre></div>
</div>
<p>The executable then must be manually copied to the package bin directory.</p>
<p>To do a thorough debugging, try adding more flags with the FFLAGS variable. Try,</p>
<blockquote>
<div>make FFLAGS=”-g -O0 -Wall -fbacktrace -fcheck=all”</div></blockquote>
<p>for example.</p>
</div>
<div class="section" id="run-process">
<span id="id2"></span><h2>Run Process<a class="headerlink" href="#run-process" title="Permalink to this headline">¶</a></h2>
<p>This section outlines the basic run process with reference to some of the most common input-output manipulation in GPEC runs. This is not meant to be a complete coverage of the many options and capabilities available to the user during this process. For a complete list of the input and output control variables please see the Namelist Variables section.</p>
<p>Public copies of the GPEC releases are available at /p/gpec on portal. The user should usually choose the latest release, lets call it &lt;release&gt;. To run GPEC, a user should first navigate to a directory in which they wish to run and write outputs. Once in the run-directory the user needs (at a minimum) the dcon, equil, vac, and gpec namelist files, which can be copied from /p/gpec/&lt;release&gt;/input for example. The user can then follow these simple steps to complete a GPEC run:</p>
<ol class="arabic simple">
<li>Edit the dcon.in file</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>DCON will only run for a single toroidal mode number. Set the toroidal mode number for the entire run here using the crucial parameter nn. GPEC outputs for multiple toroidal mode numbers can be added together in the post-processing.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Edit the equil.in file</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Specify the specific plasma shot of interest by setting the initial equilibrium file (ex: efit output g-file).</li>
<li>Set the range of normalized flux to be included in the calculation.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>$/p/gpec/&lt;release&gt;/bin/dcon</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>This creates the euler.bin file, which provides a orthonormal basis of force balance states for GPEC.</li>
<li>Once this is created, you can various effects on this equilibrium by changing the 3D field input in gpec.in without having to run DCON again.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Edit the gpec.in file</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Specify the 3D error field input file to be used in GPEC to perturb the 2D equilibrium.<ul>
<li>This must match the psihigh variable used in equil.in.</li>
</ul>
</li>
<li>Set the flags to specify the desired outputs.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>/p/gpec/&lt;release&gt;/bin/gpec</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>That’s it! Now go look at your output files.</li>
</ul>
</div></blockquote>
<p>Note that GPEC takes only two inputs. The file containing the 2D plasma equilibrium is specified in equil.in prior to the DCON run and the file defining the 3D error field on the plasma boundary surface is specified in GPEC.in prior to the the GPEC calculations.</p>
</div>
<div class="section" id="a-word-on-coordinates">
<span id="coordinates"></span><h2>A Word On Coordinates<a class="headerlink" href="#a-word-on-coordinates" title="Permalink to this headline">¶</a></h2>
<p>Keeping all the different coordinate systems used in a GPEC run can be intimidating to the first time user. Luckily, there is no reason to fear! GPEC easily switches between coordinate systems, and does not require consistency throughout the run process. That is, the inputs and outputs can have different coordinates. The coordinate system used for the DCON run specify the working coordinates for GPEC. The jac_in specified in gpec.in specifies the coordinate system used by the 3D error field input file, and jac_out specifies the coordinate system of the GPEC outputs. GPEC handles the transitions between these three coordinate systems all internally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The only real responsibility of the user is to make sure the GPEC input Jacobian is consistent with the 3D error field input file. However, the user should be aware that each coordinate system has different strengths. Hamada coordinates have the best convergence properties in general, but are poor for the inboard side of the plasma. PEST coordinates are user friendly but poor for outboard resolution. Boozer coordinates tend to find a middle ground between these, with mild convergence and fair resolution throughout the plasma.</p>
</div>
<p>The above requirements are all that is needed to understand the internal workings of GPEC’s coordinate transforms. There is, however, a final question of the various “normal” toroidal angles as defined for a specific machine. GPEC does not take into account the sign of the toroidal field. The result is, that for machines such as DIII-D with “normal” toroidal field defined as negative (BCENTER&lt;0 in efit equilibria) the phase of GPEC outputs will not match the machine-defined toroidal angle. To convert three dimensional GPEC outputs in such cases to machine coordinates it may be necessary to take the complex conjugate of a given amplitude and multiply equilibrium output toroidal fields by negative one.</p>
</div>
<div class="section" id="inputs">
<span id="id3"></span><h2>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h2>
<p>At this point it is obvious that GPEC calculations hinge on first acquiring two types of data. GPEC interfaces with the input data by simple reads of formatted text files. The format and file path’s are specified in the .in files used in the run process, and are called on to initialize the ideal equilibrium solver.</p>
<p>The first input, equilibrium profile data, is specified in the equil.in file and can come in many different forms. By far the most common option is “efit”, in which case a two dimensional EFIT output g-file is used to specify the original axi-symmetric equilibrium. This equilibrium data and file format are widely used across multiple machines, and alternative formats are supported by GPEC when necessary. It is worth noting that significant differences between kinetic EFIT equilibria and the more simple non-kinetic EFITs has been noted. Obtaining the best 2D equilibrium data possible is encouraged for detailed calculations, however the casual user should not have need to concern themselves too heavily with this input source short of looking for the kinetic EFIT when possible.</p>
<p>The second input, the 3D “error field” data, is somewhat more specific in its requirements. The input data can be again read from a file, and accepts a small number of select formats. These files must specify the external field on the surface of the GPEC plasma boundary defined by the psihigh variable in equil.in. This means that the data must be pre-processed using knowledge of both the non-axisymmetric external field (applied and/or intrinsic), the same equilibrium used in the GPEC corresponding calculation, and the exact magnetic surface used in that calculation. This requirement of coordination by the user is an easy pitfall for the un-wary. If utilizing this method, be sure that all work is consistent! To avoid the pitfalls associated with the above method a in-house Biot-Savart module that contains various coil geometries has been added as of GPEC 2.00. Using the coil_flag in gpec.in will result in the reading of yet another input file “coil.in” and the fields from the coils/currents specified therein will be calculated on the appropriate surface. Finally, the harmonic_flag allows users to apply a set amplitude harmonic on the boundary. All the 3D field input may be used (or not) in any combination, and the total boundary condition will be a sum of those used.</p>
</div>
<div class="section" id="results">
<span id="id4"></span><h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>The results of an GPEC run depend on the output flags selected in gpec.in prior to the run. Without getting into the specifics of each output, there are a few important properties any GPEC run that should always be kept in minds. Each GPEC run always returns its results in the form of consistently named .out files in the run-directory. This means that it will overwrite any previous run’s results if they are not moved first. Always move any results worth keeping to a separate directory and keep track of which runs used which inputs. Outputs are expensive, so try to limit runs to only output the essential physics of interest each time.</p>
<p>An important property of GPEC results for post-processing is their linearity. GPEC calculates results for a single toroidal harmonic. When appropriate, results from multiple runs can simply be added (to obtain a total perturbed field for example). In the same spirit, the amplitude of a plasma response calculated by GPEC is linear with the error-field. Thus, plasma response fields can be multiplier by a constant to simulate changes in a driven 3D error field.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="outputs.html" title="Outputs and Post-Processing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Indices and tables"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, PPPL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.0.
    </div>
  </body>
</html>