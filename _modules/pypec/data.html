<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pypec.data &mdash; GPEC 3.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GPEC 3.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pypec.data</h1><div class="highlight"><pre>
<span class="c">#!/usr/local/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:mod:`pypec.data` -- ASCII Table Data Turned Pythonic</span>
<span class="sd">=====================================================</span>

<span class="sd">The data module is a very generalized tool for visualizing and manipulating scientific data from netcdf and ascii files.</span>

<span class="sd">GPEC data is migrating to netcdf, and this module uses the xarray module for its python netcdf interface. The xarray module is very powerful and well documented `here &lt;http://xarray.readthedocs.org/&gt;`_.</span>

<span class="sd">Previous GPEC results and some current outputs are still writen to ascii. This module contains a custom I/O for converting ascii data to python objects. A custom Data object was created for this purpose, and conversion to the xarray Dataset is automated in the open_dataset function to facilitate migration to netcdf. The only requirement for creating a data object from an ascii file is that the file have one or more tables of data, with appropriate labels in a header line directly above the data.</span>

<span class="sd">Here, we show some examples using common outputs from both IPEC and PENT.</span>

<span class="sd">Beginners</span>
<span class="sd">---------</span>

<span class="sd">First, add your release of GPEC to your PYTHONPATH environment variable.</span>

<span class="sd">In an open ipython session, import the data module</span>

<span class="sd">&gt;&gt;&gt; from pypec import data</span>

<span class="sd">Explore the data module by typing &#39;data.&#39; and hitting tab. For information on any particular object in the module, use the &#39;?&#39; syntax or &#39;help&#39; function. For example, enter &#39;data.read?&#39;. You will see that it has a lot of metadata on this function, but the important things to look at for now are the arguments and key word arguments. These are passed to the function as shown in the Definition line... you can either pass a single string, or a string and specification for squeeze. If this confuses you, consult any of the many great python tutorials online.</span>

<span class="sd">Lets use it! To get a typical GPEC output into python, use the open_dataset function.</span>

<span class="sd">&gt;&gt;&gt; con = data.open_dataset(&#39;examples/DIIID_example/ipec_control_output_n1.nc&#39;)</span>

<span class="sd">Printing to the terminal is intelegent, giving a conviniently human readable summary of the data.</span>

<span class="sd">&gt;&gt;&gt; con</span>
<span class="sd">&lt;xarray.Dataset&gt;</span>
<span class="sd">Dimensions:        (i: 2, m: 129, mode: 34, mode_PX: 34, mode_RX: 34, mode_SC: 4, mode_WX: 34, mode_XT: 34, theta: 513)</span>
<span class="sd">Coordinates:</span>
<span class="sd">  * i              (i) int32 0 1</span>
<span class="sd">  * m              (m) int32 -64 -63 -62 -61 -60 -59 -58 -57 -56 -55 -54 -53 ...</span>
<span class="sd">  * mode           (mode) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...</span>
<span class="sd">  * mode_SC        (mode_SC) int32 1 2 3 4</span>
<span class="sd">  * theta          (theta) float64 0.0 0.001953 0.003906 0.005859 0.007812 ...</span>
<span class="sd">  * mode_XT        (mode_XT) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...</span>
<span class="sd">  * mode_WX        (mode_WX) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...</span>
<span class="sd">  * mode_RX        (mode_RX) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...</span>
<span class="sd">  * mode_PX        (mode_PX) int32 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ...</span>
<span class="sd">Data variables:</span>
<span class="sd">    L              (mode, m) complex128 (-0.478146242223-0.0251176845733j) ...</span>
<span class="sd">    Lambda         (mode, m) complex128 (1.4032106893e-07-3.56355823737e-08j) ...</span>
<span class="sd">    P              (mode, m) complex128 (0.000212307471204-9.52839135614e-05j) ...</span>
<span class="sd">    rho            (mode, m) complex128 (9.96920996839e+36+9.96920996839e+36j) ...</span>
<span class="sd">    X_EDT          (mode_XT, m) complex128 (3.88116613338e-05+1.90243722796e-05j) ...</span>
<span class="sd">    X_EVT          (mode_XT) float64 2.517e+04 1.334e+05 5.081e+05 1.119e+06 ...</span>
<span class="sd">    W_EDX          (mode_WX, m) complex128 (2.0673520088e-06-4.52521668335e-07j) ...</span>
<span class="sd">    W_EVX          (mode_WX) float64 8.543 2.882 2.516 1.137 0.8107 0.6662 ...</span>
<span class="sd">    W_EVX_A        (mode_WX) float64 3.922e+05 7.805e+04 2.466e+05 3.042e+05 ...</span>
<span class="sd">    W_EVX_energyv  (mode_WX) float64 6.701e+06 4.499e+05 1.241e+06 6.917e+05 ...</span>
<span class="sd">    W_EVX_energys  (mode_WX) float64 6.383e+06 8.481e+05 1.724e+06 6.867e+05 ...</span>
<span class="sd">    W_EVX_energyp  (mode_WX) float64 6.817e+06 5.582e+05 8.381e+05 5.807e+05 ...</span>
<span class="sd">    R_EDX          (mode_RX, m) complex128 (-9.04352944467e-07-5.23229281269e-07j) ...</span>
<span class="sd">    R_EVX          (mode_RX) float64 1.881e+06 8.165e+05 2.477e+05 1.895e+05 ...</span>
<span class="sd">    R_EVX_RL       (mode_RX) float64 5.689 0.7149 0.3795 0.8092 0.2417 ...</span>
<span class="sd">    R_EVX_energyv  (mode_RX) float64 4.298e+05 1.373e+06 1.01e+06 7.832e+05 ...</span>
<span class="sd">    R_EVX_energys  (mode_RX) float64 8.994e+05 1.745e+06 1.096e+06 8.803e+05 ...</span>
<span class="sd">    R_EVX_energyp  (mode_RX) float64 3.785e+05 8.975e+05 8.31e+05 6.814e+05 ...</span>
<span class="sd">    P_EDX          (mode_PX, m) complex128 (-5.0711563448e-06-2.51239391938e-06j) ...</span>
<span class="sd">    P_EVX          (mode_PX) float64 493.5 161.8 146.4 128.7 127.8 110.2 ...</span>
<span class="sd">    O_WRX          (mode_RX, mode_WX) float64 0.082 0.99 0.08839 0.01132 ...</span>
<span class="sd">    O_WPX          (mode_PX, mode_WX) float64 0.01414 0.9607 0.08296 0.01058 ...</span>
<span class="sd">    O_RPX          (mode_PX, mode_RX) float64 0.9571 0.01583 0.02807 0.1558 ...</span>
<span class="sd">    O_XT           (mode_XT) complex128 (0.00296215168999+0.00489536349583j) ...</span>
<span class="sd">    O_WX           (mode_XT) complex128 (0.0101206436883-0.00397946238035j) ...</span>
<span class="sd">    O_RX           (mode_RX) complex128 (-0.00967090555989-0.000112969521773j) ...</span>
<span class="sd">    O_PX           (mode_PX) complex128 (-0.00598278876631+0.0105074013581j) ...</span>
<span class="sd">    Phi_EX         (m) complex128 (-1.42853908779e-10-4.20811059626e-11j) ...</span>
<span class="sd">    Phi_ET         (m) complex128 (-6.89310992668e-10-1.01978717443e-09j) ...</span>
<span class="sd">    W_EDX_FUN      (mode_WX, theta) complex128 (-1.45421344314-0.0472501327701j) ...</span>
<span class="sd">    R_EDX_FUN      (mode_RX, theta) complex128 (1.45665015126-0.521253285202j) ...</span>
<span class="sd">    b_nm           (m) complex128 (-9.46126704696e-10+1.48737377032e-09j) ...</span>
<span class="sd">    b_xnm          (m) complex128 (-5.48365827795e-10+5.89720875704e-10j) ...</span>
<span class="sd">    xi_nm          (m) complex128 (-3.3871234611e-09-1.86371281018e-09j) ...</span>
<span class="sd">    xi_xnm         (m) complex128 (-6.60388933097e-10+2.7635104984e-09j) ...</span>
<span class="sd">    xi_n           (theta) complex128 (0.000402066428626+0.00260098774146j) ...</span>
<span class="sd">    xi_xn          (theta) complex128 (-0.000601114809848-0.00197978522356j) ...</span>
<span class="sd">    b_n            (theta) complex128 (-0.00157772177652+0.00052698051739j) ...</span>
<span class="sd">    b_xn           (theta) complex128 (-0.000920387597747+0.000315158824532j) ...</span>
<span class="sd">    R              (theta) float64 2.289 2.289 2.288 2.287 2.286 2.284 2.282 ...</span>
<span class="sd">    z              (theta) float64 0.02442 0.03972 0.05506 0.07046 0.08596 ...</span>
<span class="sd">    R_n            (theta) float64 1.0 0.9995 0.9981 0.9959 0.9928 0.9889 ...</span>
<span class="sd">    z_n            (theta) float64 0.003568 0.03241 0.06134 0.09036 0.1195 ...</span>
<span class="sd">    dphi           (theta) float64 0.0 -0.039 -0.078 -0.117 -0.1559 -0.1948 ...</span>
<span class="sd">Attributes:</span>
<span class="sd">    title: IPEC outputs in Fourier or alternate modal bases</span>
<span class="sd">    Jacobian: pest</span>
<span class="sd">    q_lim: 5.2</span>
<span class="sd">    psi_n_lim: 0.991536136179</span>
<span class="sd">    shot: 147131</span>
<span class="sd">    time: 2300</span>
<span class="sd">    machine: DIII-D</span>
<span class="sd">    n: 1</span>
<span class="sd">    version: GPEC version 0.3.1</span>
<span class="sd">    long_name: Surface Inductance</span>
<span class="sd">    energy_vacuum: 3.28697635252</span>
<span class="sd">    energy_surface: 7.8714975121</span>
<span class="sd">    energy_plasma: 3.7597335618</span>

<span class="sd">We see the data contains dimensions, variables, and global attributes. Some individual data arrays may have attributes as well.</span>

<span class="sd">For quick visualization, we can use xarray&#39;s built in plotting routines,</span>

<span class="sd">&gt;&gt;&gt; import xarray.plot as xplot</span>
<span class="sd">&gt;&gt;&gt; f1,a1 = plt.subplots()</span>
<span class="sd">&gt;&gt;&gt; l1 = xplot.plot(con[&#39;W_EVX&#39;]) # 1D data, returns a list of lines</span>
<span class="sd">&gt;&gt;&gt; f1.savefig(&#39;examples/example_eigenvalues.png&#39;)</span>

<span class="sd">.. image:: examples/example_eigenvalues.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">&gt;&gt;&gt; f2,a2 = plt.subplots()</span>
<span class="sd">&gt;&gt;&gt; l2 = xplot.plot(con[&#39;W_EDX&#39;]) # This is 2D, returns Quadmesh</span>
<span class="sd">&gt;&gt;&gt; f2.savefig(&#39;examples/example_eigenvectors.png&#39;)</span>

<span class="sd">.. image:: examples/example_eigenvectors.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">Note this uses matplotlib, and the plots are fully interactive. Navigate and zoom using the toolbar below plots.</span>

<span class="sd">This is not the recommended way to display detailed studies using GPEC data, however. It is</span>
<span class="sd">recommended that the user familiarise themselves with matplotlib (there are many great online</span>
<span class="sd">tutorials) and write their own scripts for plotting the data of interest, as details will</span>
<span class="sd">inevitably need tweaking.</span>

<span class="sd">For a common example of more customized plots, lets look at some 2d data</span>

<span class="sd">&gt;&gt;&gt; cyl = data.open_dataset(&#39;examples/DIIID_example/ipec_cylindrical_output_n1.nc&#39;)</span>

<span class="sd">We could use the built in plotting methods like ds[&#39;b_z&#39;].plot), but these are (R,z) figures</span>
<span class="sd">should be done with a little care to look right. Lets look at b_z for example,</span>

<span class="sd">&gt;&gt;&gt; plt = data.plt</span>
<span class="sd">&gt;&gt;&gt; f,ax = plt.subplots(figsize=(8,8))</span>
<span class="sd">&gt;&gt;&gt; v = cyl[&#39;b_z&#39;]</span>
<span class="sd">&gt;&gt;&gt; im = ax.imshow(np.real(v),aspect=&#39;equal&#39;,origin=&#39;lower&#39;,cmap=&#39;RdBu&#39;,vmin=-2e-3,vmax=2e-3,</span>
<span class="sd">...          extent=[v[&#39;R&#39;].min(),v[&#39;R&#39;].max(),v[&#39;z&#39;].min(),v[&#39;z&#39;].max()],</span>
<span class="sd">...          interpolation=&#39;gaussian&#39;)</span>
<span class="sd">&gt;&gt;&gt; cb = f.colorbar(im)</span>
<span class="sd">&gt;&gt;&gt; cb.set_label(&#39;$\delta B_z$&#39;)</span>
<span class="sd">&gt;&gt;&gt; xtks = ax.set_xticks([1,1.7,2.4])</span>
<span class="sd">&gt;&gt;&gt; xtxt = ax.set_xlabel(&#39;R (m)&#39;)</span>
<span class="sd">&gt;&gt;&gt; ytxt = ax.set_ylabel(&#39;z (m)&#39;)</span>
<span class="sd">&gt;&gt;&gt; f.savefig(&#39;examples/example_pbrzphi.png&#39;)</span>

<span class="sd">.. image:: examples/example_pbrzphi.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">There we go. That looks publication ready!</span>

<span class="sd">Another common plot of GPEC outputs is the (psi,m) spectrogram plot. Lets quickly make a</span>
<span class="sd">nice one,</span>

<span class="sd">&gt;&gt;&gt; prof = data.open_dataset(&#39;examples/DIIID_example/ipec_profile_output_n1.nc&#39;)</span>
<span class="sd">&gt;&gt;&gt; f,ax = plt.subplots()</span>
<span class="sd">&gt;&gt;&gt; extent = [prof[&#39;m&#39;].min(),prof[&#39;m&#39;].max(),prof[&#39;psi_n&#39;].min(),prof[&#39;psi_n&#39;].max()]</span>
<span class="sd">&gt;&gt;&gt; im = ax.imshow(np.abs(prof[&#39;xi_m_contrapsi&#39;]).T,origin=&#39;lower&#39;,cmap=&#39;viridis&#39;,</span>
<span class="sd">...                interpolation=&#39;nearest&#39;,aspect=&#39;auto&#39;,extent=extent)</span>
<span class="sd">&gt;&gt;&gt; cb = f.colorbar(im)</span>
<span class="sd">&gt;&gt;&gt; cb.set_label(r&#39;$\\xi^\psi_m$&#39;)</span>
<span class="sd">&gt;&gt;&gt; lim = ax.set_xlim(-20,20)</span>
<span class="sd">&gt;&gt;&gt; xtxt = ax.set_xlabel(&#39;m&#39;)</span>
<span class="sd">&gt;&gt;&gt; ytxt = ax.set_ylabel(r&#39;$\psi$&#39;)</span>

<span class="sd">&gt;&gt;&gt; f.savefig(&#39;examples/example_xispectrogram.png&#39;)</span>

<span class="sd">.. image:: examples/example_xispectrogram.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">Note that the choice of interpolation resulted in discrete bands in m, which is true</span>
<span class="sd">to the the discrete fourier decomposition used in the codes and provides a more intuitive</span>
<span class="sd">connection between what the user sees and what the code is calculating.</span>

<span class="sd">One of the many cool additions to matplotlib in the pypec package is the ability to</span>
<span class="sd">write line plots to tables. Lets look at a 1D mode spectrum plot for example,</span>

<span class="sd">&gt;&gt;&gt; f,ax = plt.subplots()</span>
<span class="sd">&gt;&gt;&gt; for m in range(1,9):</span>
<span class="sd">...     lines = ax.plot(prof[&#39;psi_n&#39;],np.abs(prof[&#39;xi_m_contrapsi&#39;].sel(m=m)),label=r&#39;m={:}&#39;.format(m))</span>
<span class="sd">&gt;&gt;&gt; mappable = plt.set_linearray(ax.lines,cmap=&#39;viridis&#39;)</span>
<span class="sd">&gt;&gt;&gt; ytxt = ax.set_ylabel(r&#39;$\\xi^\psi_m$&#39;)</span>
<span class="sd">&gt;&gt;&gt; xtxt = ax.set_xlabel(r&#39;$\psi$&#39;)</span>
<span class="sd">&gt;&gt;&gt; leg = ax.legend(ncol=2)</span>
<span class="sd">&gt;&gt;&gt; f.savefig(&#39;examples/example_xim.png&#39;)</span>
<span class="sd">&gt;&gt;&gt; f.printlines(&#39;examples/example_xim.dat&#39;,squeeze=True)</span>
<span class="sd">Wrote lines to examples/example_xim.dat</span>
<span class="sd">True</span>

<span class="sd">.. image:: examples/example_xim.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">That&#39;s it! Read the table with your favorite editor. It will probably need a little</span>
<span class="sd">cleaning at the top since it tries to use the lengthy legend labels as column headers.</span>


<span class="sd">Advanced Users</span>
<span class="sd">--------------</span>

<span class="sd">In this section, we will assume you have a pretty good hold on both python and the basic ploting functions of these modules.</span>

<span class="sd">Now that you use this module regularly, save yourself some time by placing the line:</span>

<span class="sd">  from pypec import *</span>

<span class="sd">into your autoimport file located at</span>
<span class="sd">~/.ipython/profile_default/startup/autoimports.ipy</span>


<span class="sd">Deprecated Ascii Interface</span>
<span class="sd">---------------------------</span>

<span class="sd">As mentioned above, GPEC has moved the vast majority of its I/O to netcdf, and open_dataset should</span>
<span class="sd">be used to create xarray Dataset objects whenever possible. This section describes the deprecated</span>
<span class="sd">ascii interface for context, and motivates the move to netcdf.</span>

<span class="sd">Data in ascii tables can be read into a custom Data object using the read function,</span>

<span class="sd">&gt;&gt;&gt; mydata = read(&#39;examples/DIIID_example/g147131.02300_DIIID_KEFIT.kin&#39;)</span>
<span class="sd">Casting table 1 into Data object.</span>
<span class="sd">&gt;&gt;&gt; type(mydata),len(mydata)</span>
<span class="sd">(&lt;type &#39;list&#39;&gt;, 1)</span>

<span class="sd">The read function creates a list of data objects corresponding to the tables in the text file. In this case, there is only one table. If we knew this ahead of time, we could have gotten the data object directly by splitting the list.</span>

<span class="sd">&gt;&gt;&gt; mydata = read(&#39;examples/DIIID_example/g147131.02300_DIIID_KEFIT.kin&#39;)[0]</span>
<span class="sd">Casting table 1 into Data object.</span>

<span class="sd">At its heart, the data object consists of independent data and dependent data. This are stored differently, namely as a list in the pts attribute and as a dictionary in y. The x attribute is a dictionary if the data is 1 dimensional or a regular grid is found in the first n columns of the data (n=2,3), and left empty if the n&gt;1 dependent data is irregular.</span>

<span class="sd">Explore the data using the corresponding python tools.</span>

<span class="sd">&gt;&gt;&gt; mydata.xnames</span>
<span class="sd">[&#39;psi&#39;]</span>
<span class="sd">&gt;&gt;&gt; mydata.y.keys()</span>
<span class="sd">[&#39;nim^3&#39;, &#39;tieV&#39;, &#39;teeV&#39;, &#39;wexbrad/s&#39;, &#39;nem^3&#39;]</span>

<span class="sd">You would access the ion density data using mydata.y[&#39;nim3&#39;] for example.</span>

<span class="sd">The data object, however, is more that just a place holder for parced text files. It contains visualization and data manipulation tools. Plotting functions return interactive matplotlib Figure objects.</span>

<span class="sd">&gt;&gt;&gt; fig = mydata.plot1d()</span>
<span class="sd">&gt;&gt;&gt; fig.savefig(&#39;examples/example_profiles.png&#39;)</span>

<span class="sd">.. image:: examples/example_profiles.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">Interpolation returns a new Data object of the desired data, which can be one, multiple, or all of the dependent variables found in y.</span>

<span class="sd">&gt;&gt;&gt; myinterp = mydata.interp(np.arange(0.1,1.0,0.1),[&#39;nim^3&#39;,&#39;tieV&#39;])</span>
<span class="sd">Forming interpolator for nim^3.</span>
<span class="sd">Interpolating values for nim^3.</span>
<span class="sd">Forming interpolator for tieV.</span>
<span class="sd">Interpolating values for tieV.</span>
<span class="sd">&gt;&gt;&gt; f = mydata.plot1d(&#39;nim^3&#39;)</span>
<span class="sd">&gt;&gt;&gt; f = myinterp.plot1d(&#39;nim^3&#39;,marker=&#39;s&#39;,lw=0,figure=f)</span>
<span class="sd">&gt;&gt;&gt; f.savefig(&#39;examples/example_profiles2.png&#39;)</span>

<span class="sd">.. image:: examples/example_profiles2.png</span>
<span class="sd">   :width: 400px</span>

<span class="sd">Note that the interpolator initialized the interpolation function on the first call, this is saved internally for subsequent calls.</span>

<span class="sd">One common need is to look at spectra. For this we want to utilize</span>
<span class="sd">the full functionality of the data instances&#39; plot1d function.</span>

<span class="sd">&gt;&gt;&gt; xc, = read(&#39;examples/DIIID_example/ipec_xclebsch_n1.out&#39;)</span>
<span class="sd">Casting table 1 into Data object.</span>
<span class="sd">&gt;&gt;&gt; f = xc.plot1d(&#39;xi^psi&#39;,&#39;psi&#39;,x2rng=(1,3))</span>
<span class="sd">&gt;&gt;&gt; f.savefig(&#39;examples/example_spectrum.png&#39;)</span>

<span class="sd">.. image:: examples/example_spectrum.png</span>
<span class="sd">   :width: 600px</span>

<span class="sd">We knew it was one table, so we used the &quot;,&quot; to automatically</span>
<span class="sd">unpack returned list. We were then so familiar with the args and</span>
<span class="sd">kwargs of the plotting function that we did not bother typing the names.</span>
<span class="sd">If you do this, be sure you get the order consistent with the order</span>
<span class="sd">given in the documentation &quot;Definition&quot; line (watch out for inconsistent</span>
<span class="sd">&quot;Docstring&quot; listings).</span>


<span class="sd">.. note::</span>
<span class="sd">  These examples can be tested by developers using ipython </span>
<span class="sd">  in this directory as follows:</span>

<span class="sd">    In [1]: import data,doctest</span>
<span class="sd">   </span>
<span class="sd">    In [2]: doctest.testmod(data,verbose=True)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @package pypec</span>
<span class="sd">    @author NC Logan</span>
<span class="sd">    @email nlogan@pppl.gov</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">copy</span><span class="o">,</span><span class="nn">time</span>

<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span><span class="n">capitalize</span><span class="p">,</span><span class="n">count</span>         <span class="c"># faster than &#39;+&#39; loop</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">MethodType</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>                               <span class="c"># math</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span><span class="p">,</span><span class="n">interp2d</span><span class="p">,</span><span class="n">LinearNDInterpolator</span><span class="p">,</span><span class="n">RegularGridInterpolator</span><span class="p">,</span><span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">ellipk</span><span class="p">,</span><span class="n">ellipe</span>

<span class="c">#in this package</span>
<span class="kn">import</span> <span class="nn">modplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">namelist</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mayavi.mlab</span> <span class="kn">as</span> <span class="nn">mmlab</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">mmlab</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Mayavi not in python path&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xarray</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">xarray</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: xarray not in python path&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39; -&gt; We recomend loading anaconda/2.3.0 on portal&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">sns</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: seaborn not in python path&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39; -&gt; We recomend loading anaconda/2.3.0 on portal&#39;</span><span class="p">)</span>

<span class="c"># better label recognition using genfromtxt</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&#39;^|&lt;&gt;/&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_iotools</span><span class="o">.</span><span class="n">NameValidator</span><span class="o">.</span><span class="n">defaultdeletechars</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_iotools</span><span class="o">.</span><span class="n">NameValidator</span><span class="o">.</span><span class="n">defaultdeletechars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c">######################################################## Global Variables</span>

<span class="n">default_quiet</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">cmap_div</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;RdBu_r&#39;</span><span class="p">)</span>
<span class="n">cmap_seq</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;viridis&#39;</span><span class="p">)</span> <span class="c">#_load_default_cmap()</span>

<span class="c">######################################################## Change default keywords</span>

<div class="viewcode-block" id="interp1d_unbound"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.interp1d_unbound">[docs]</a><span class="k">def</span> <span class="nf">interp1d_unbound</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="n">bounds_error</span><span class="p">,</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="n">assume_sorted</span><span class="p">)</span></div>
<span class="n">interp1d_unbound</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">interp1d</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;Examples&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Examples fail doctest</span>

<span class="c">######################################################## Helper functions</span>

<span class="k">def</span> <span class="nf">_set_color_defaults</span><span class="p">(</span><span class="n">calc_data</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stolen from xarray.plot. Sets vmin, vmax, cmap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;vmin&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;vmax&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cmap&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">calc_data</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">calc_data</span><span class="p">,</span> <span class="mi">98</span><span class="p">)</span>
    <span class="c"># Simple heuristics for whether these data should  have a divergent map</span>
    <span class="n">divergent</span> <span class="o">=</span> <span class="p">((</span><span class="n">vmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c"># Now set center to 0 so math below makes sense</span>
    <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># A divergent map should be symmetric around the center value</span>
    <span class="k">if</span> <span class="n">divergent</span><span class="p">:</span>
        <span class="n">vlim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">vmin</span> <span class="o">-</span> <span class="n">center</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">center</span><span class="p">))</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">vlim</span><span class="p">,</span> <span class="n">vlim</span>
    <span class="c"># Now add in the centering value and set the limits</span>
    <span class="n">vmin</span> <span class="o">+=</span> <span class="n">center</span>
    <span class="n">vmax</span> <span class="o">+=</span> <span class="n">center</span>
    <span class="c"># Choose default colormaps if not provided</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">divergent</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s">&quot;RdBu_r&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s">&quot;viridis&quot;</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmin</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmax</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

    <span class="k">return</span> <span class="n">kwargs</span>

<span class="c">######################################################## IO FOR DATA OBJECTs</span>

<div class="viewcode-block" id="open_dataset"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.open_dataset">[docs]</a><span class="k">def</span> <span class="nf">open_dataset</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span><span class="n">complex_dim</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for xarray.open_dataset that allows automated reduction of</span>
<span class="sd">    a dimension destinguishing real and imaginary components.</span>

<span class="sd">    New Parameter</span>
<span class="sd">    -------------</span>
<span class="sd">    complex_dim : str, Dimension designating real/imaginary (0,1)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dat</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No regular grid for dataset&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">yk</span><span class="p">,</span><span class="n">yv</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">yk</span><span class="p">]</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">yv</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span><span class="n">coords</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">xnames</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">complex_dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">complex_dim</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">attrs</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="n">complex_dim</span><span class="p">:</span><span class="mi">0</span><span class="p">}]</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="n">complex_dim</span><span class="p">:</span><span class="mi">1</span><span class="p">}]</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">tmp</span>

    <span class="k">return</span> <span class="n">ds</span></div>
<span class="n">open_dataset</span><span class="o">.</span><span class="n">__doc__</span><span class="o">+=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="o">.</span><span class="n">__doc__</span>

<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">forcex</span><span class="o">=</span><span class="p">[],</span><span class="n">forcedim</span><span class="o">=</span><span class="p">[],</span><span class="n">maxnumber</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span><span class="n">maxlength</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
         <span class="n">auto_complex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="n">default_quiet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the data from any ipec output as a list of python </span>
<span class="sd">    class-type objects using numpy.genfromtxt.</span>

<span class="sd">    Arguments</span>
<span class="sd">      fname      : str. </span>
<span class="sd">        Path of ipec output file.</span>
<span class="sd">    </span>
<span class="sd">    Key Word Arguments:</span>
<span class="sd">      squeeze : bool. </span>
<span class="sd">        Sets all attributes to single data object.</span>
<span class="sd">      forcex  : list. </span>
<span class="sd">        Set independent data labels.</span>
<span class="sd">      forcedim : list.</span>
<span class="sd">        Set dimensionality of each x.</span>
<span class="sd">      maxnumber : int.</span>
<span class="sd">        Reads only first maxnumber of tables.</span>
<span class="sd">      maxlength : int.</span>
<span class="sd">        Tables with more rows than this are downsampled for speed.</span>
<span class="sd">      auto_complex : bool.</span>
<span class="sd">        Include amplitude and phase of complex data as variables.</span>
<span class="sd">      quiet   : bool.</span>
<span class="sd">        Prevent non-warning messages printed to terminal.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      list. </span>
<span class="sd">        Class objects for each block of data in the file.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#debug start_time = time.time()</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dcollection</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pcollection</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c">#Get preamble</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">lastline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">lstart</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">preamble</span><span class="o">+=</span> <span class="n">lastline</span>
                <span class="n">lastline</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c">#Simple file : single table</span>
            <span class="c">#data = np.genfromtxt(f,skip_header=lstart-1,names=True,dtype=np.float)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span> <span class="c"># genfromtxt read pfile (multiple 2-column tables) as one... &#39;\r&#39; bug</span>
            <span class="n">pcollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preamble</span><span class="p">)</span>
            <span class="n">dcollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c">#look through file manually</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c"># clean up messy dcon output formats</span>
            <span class="k">if</span> <span class="s">&#39;dcon.out&#39;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;mu0 p&#39;</span><span class="p">,</span><span class="s">&#39;mu0p&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; abs &#39;</span><span class="p">,</span><span class="s">&#39; abs&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; re &#39;</span><span class="p">,</span><span class="s">&#39; real&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; im &#39;</span><span class="p">,</span><span class="s">&#39; imag&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">top</span><span class="p">,</span><span class="n">bot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">length</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">bot</span><span class="o">&lt;</span><span class="n">length</span> <span class="ow">and</span> <span class="n">top</span><span class="o">&lt;</span><span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">count</span><span class="o">&lt;</span><span class="n">maxnumber</span><span class="p">:</span>
                <span class="n">preamble</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                <span class="n">lastline</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">bot</span><span class="p">:]):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c"># Find top defined as start of numbers</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">top</span> <span class="o">=</span> <span class="n">bot</span><span class="o">+</span><span class="n">i</span>
                        <span class="c"># Throw out single lines of numbers </span>
                        <span class="c">#if not lines[top+1].translate(None,&#39; \n\t\r&#39;):#==&#39;\n&#39;: </span>
                        <span class="c">#    raise ValueError</span>
                        <span class="c"># Find bottom defined by end of numbers</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">bline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="p">:]):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">break</span> <span class="c"># end of numbers</span>
                        <span class="c"># Throw out single lines of numbers</span>
                        <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="c"># but include them as preamble (DCON one-liners)</span>
                            <span class="n">vals</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="p">]</span>
                            <span class="n">keys</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39; </span><span class="se">\n\t</span><span class="s">&#39;</span><span class="p">):</span> <span class="c">#empty line</span>
                                <span class="n">keys</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">vals</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
                                    <span class="n">preamble</span><span class="o">+=</span><span class="s">&#39;{:} = {:}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bot</span> <span class="o">=</span> <span class="n">top</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
                        <span class="k">break</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">preamble</span><span class="o">+=</span> <span class="n">lastline</span>
                        <span class="n">lastline</span> <span class="o">=</span> <span class="n">line</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">line</span><span class="o">==</span><span class="n">lastline</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c">#end of file without another table</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                try:</span>
<span class="sd">                    bot = top+lines[top:].index(&#39; \n&#39;)</span>
<span class="sd">                except ValueError:</span>
<span class="sd">                    try:</span>
<span class="sd">                        bot = top+lines[top:].index(&#39;\n&#39;)</span>
<span class="sd">                    except ValueError:</span>
<span class="sd">                        try:</span>
<span class="sd">                            bot = top+lines[top:].index(&#39;\r\n&#39;)</span>
<span class="sd">                        except:</span>
<span class="sd">                            try:</span>
<span class="sd">                                bot = top+lines[top:].index(&#39; \r\n&#39;)</span>
<span class="sd">                            except:</span>
<span class="sd">                                bot = length</span>
<span class="sd">                &quot;&quot;&quot;</span>
                
                <span class="c"># include headers</span>
                <span class="n">top</span><span class="o">-=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39; </span><span class="se">\n\t</span><span class="s">&#39;</span><span class="p">):</span> <span class="c">#empty line</span>
                    <span class="n">top</span><span class="o">-=</span><span class="mi">1</span>
                <span class="n">skipfoot</span> <span class="o">=</span> <span class="n">length</span><span class="o">-</span><span class="n">bot</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">top</span><span class="p">:</span><span class="n">bot</span><span class="p">]</span>
                <span class="k">if</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span> <span class="c">#empty space</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">table</span><span class="p">)),</span><span class="n">names</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">deletechars</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                <span class="n">pcollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preamble</span><span class="p">)</span>
                <span class="n">dcollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c">#debug print(&quot;Finished parsing file in &quot;</span>
        <span class="c">#debug       +&quot;{} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#turn arrays into classes</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">data</span><span class="p">,</span><span class="n">preamble</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dcollection</span><span class="p">,</span><span class="n">pcollection</span><span class="p">)):</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> 
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Casting table &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; into Data object.&quot;</span><span class="p">)</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DataBase</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">preamble</span><span class="p">,</span><span class="n">forcex</span><span class="o">=</span><span class="n">forcex</span><span class="p">,</span><span class="n">forcedim</span><span class="o">=</span><span class="n">forcedim</span><span class="p">,</span><span class="n">maxlength</span><span class="o">=</span><span class="n">maxlength</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">))</span>
            
    <span class="c"># force all attributes to single object</span>
    <span class="k">if</span> <span class="n">squeeze</span><span class="p">:</span>
        <span class="n">dc1</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dc</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">dc1</span><span class="o">+=</span><span class="n">dc</span>
        <span class="k">return</span> <span class="n">dc1</span>

    <span class="k">return</span> <span class="n">collection</span>

</div>
<div class="viewcode-block" id="readall"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.readall">[docs]</a><span class="k">def</span> <span class="nf">readall</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;pent_n1.out&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively searches base directory for files with name</span>
<span class="sd">    filetype, reads them into python objects, and stores </span>
<span class="sd">    objects in a dictionary with directory names as keys.</span>
<span class="sd">    </span>
<span class="sd">    Key Word Arguments:</span>
<span class="sd">      base     : str. </span>
<span class="sd">        Top level directory in which to begin search.</span>
<span class="sd">      filetype : str. </span>
<span class="sd">        Files to read.</span>
<span class="sd">      kwargs :dict. </span>
<span class="sd">        Passed to appropriate reader function.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      dict.</span>
<span class="sd">        Key-Value pairs are directories and their contained data.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span><span class="p">(</span><span class="s">&#39;.in&#39;</span> <span class="ow">in</span> <span class="n">filetype</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">namelist</span><span class="o">.</span><span class="n">read</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">read</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;/&#39;</span>
    <span class="c">#if(base[-1]!=&#39;/&#39;): base+=&#39;/&#39;</span>
        
    <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="n">name</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">subs</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">subd</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">subd</span><span class="p">]</span> <span class="o">=</span> <span class="n">readall</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="o">+</span><span class="n">subd</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="n">filetype</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="n">filetype</span><span class="p">]</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="n">filetype</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_cleandict</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="c"># not a dict if only result in the directory</span>
    <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">==</span><span class="p">[</span><span class="n">filetype</span><span class="p">]:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">filetype</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
</div>
<span class="k">def</span> <span class="nf">_cleandict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Helper function to clear empty keys from dictionary.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">==</span><span class="nb">dict</span><span class="p">:</span>
            <span class="n">_cleandict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="c">#return d</span>


<div class="viewcode-block" id="write"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.write">[docs]</a><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">dataobj</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="p">[],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write data object to file. The aim is to replicate the original file</span>
<span class="sd">    structure... the header text will have been lost in the read however,</span>
<span class="sd">    as will some column label symbols in the use of genfromtxt.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">      dataobj : obj. </span>
<span class="sd">        Data_Base type object.</span>
<span class="sd">      fname   : str. </span>
<span class="sd">        File to write to.</span>
<span class="sd">    </span>
<span class="sd">      kwargs  : dict. </span>
<span class="sd">      Passed to numpy.savetxt</span>

<span class="sd">    Returns:</span>
<span class="sd">      bool. </span>
<span class="sd">        True.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">if</span> <span class="s">&#39;fmt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%16.8E</span><span class="s">&#39;</span>
    <span class="k">if</span> <span class="s">&#39;delimiter&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39; &#39;</span>
    <span class="k">if</span> <span class="s">&#39;comments&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;comments&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="s">&#39;header&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dataobj</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="n">k</span><span class="o">+</span><span class="s">&quot; = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="n">nums</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span> <span class="o">=</span> <span class="n">dataobj</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">xnames</span><span class="p">):</span>
        <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;{:&gt;16}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ynames</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;{:&gt;16}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;real(&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;{:&gt;16}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;imag(&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataobj</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;delimiter&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;{:&gt;16}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">True</span>



</div>
<div class="viewcode-block" id="plotall"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.plotall">[docs]</a><span class="k">def</span> <span class="nf">plotall</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">xfun</span><span class="p">,</span><span class="n">yfun</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Line plot of data gethered recursively from a dictionary </span>
<span class="sd">    containing multiple namelists or data objects.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      results : dict. </span>
<span class="sd">        A readall result.</span>
<span class="sd">      xfun    : func. </span>
<span class="sd">        A function that takes args (key,val) for each dictionary item </span>
<span class="sd">        and whose result is appended to the xaxis.</span>
<span class="sd">      yfun    : func. </span>
<span class="sd">        A function that takes args (key,val) for each dictionary item </span>
<span class="sd">        and whose result is appended to the yaxis.</span>

<span class="sd">    Key Word Arguments:</span>
<span class="sd">      axes    : obj. </span>
<span class="sd">        matplotlib axes object.</span>
<span class="sd">      kwargs  : dict. </span>
<span class="sd">        Passed to matplotlib plot function</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      figure.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">newpoint</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">newpoint</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xfun</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yfun</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">newpoint</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">z</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="c">######################################################## THE BASE IPEC DATA OBJECTS</span>
</div>
<div class="viewcode-block" id="DataBase"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase">[docs]</a><span class="k">class</span> <span class="nc">DataBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An emtpy class object with the following operations overloaded::</span>

<span class="sd">      +,-,*,/,**</span>

<span class="sd">    such that the operation is only performed on the attributes </span>
<span class="sd">    starting with .real_ and .imag_ and ending with r,z, or phi. </span>
<span class="sd">    If the two factors in the operation have different r or z attributes</span>
<span class="sd">    data is interpolated to the wider spaced axis.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fromtxt</span><span class="p">,</span><span class="n">preamble</span><span class="p">,</span><span class="n">forcex</span><span class="o">=</span><span class="p">[],</span><span class="n">forcedim</span><span class="o">=</span><span class="p">[],</span><span class="n">maxlength</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
                 <span class="n">auto_complex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="n">default_quiet</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes structured array from numpy.genfromtxt, and creates</span>
<span class="sd">        dictionaries of dependent and independent data. Also breaks</span>
<span class="sd">        down preamble to find any global parameters.</span>
<span class="sd">        </span>
<span class="sd">        **Arguments:**</span>
<span class="sd">          fromtxt : structured array. </span>
<span class="sd">          preamble: str.</span>
<span class="sd">          </span>
<span class="sd">        **Key Word Arguments:**</span>
<span class="sd">          forcex  : list.</span>
<span class="sd">            x-axis labels.</span>
<span class="sd">          maxlength : int.</span>
<span class="sd">            Tables with more rows than this are downsampled for speed.</span>
<span class="sd">          auto_complex : bool.</span>
<span class="sd">            Include amplitude and phase of complex data as variables.</span>
<span class="sd">          quiet : bool.</span>
<span class="sd">            Supress printed information and warnings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#debug start_time = time.time()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fromtxt</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">)</span>
        <span class="n">potxnames</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="c"># Set independent/dependent variables (max 3D,min 3pt grid)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">forcex</span><span class="p">]):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Requested axes not available. Using default left column(s).&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">forcex</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">forcex</span><span class="p">]):</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forcex</span><span class="p">)</span>
            <span class="n">potxnames</span> <span class="o">=</span> <span class="n">forcex</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">potxnames</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c"># hack for psi,q pairs</span>
            <span class="k">if</span> <span class="s">&#39;q&#39;</span> <span class="ow">in</span> <span class="n">potxnames</span><span class="p">:</span>
                <span class="n">potxnames</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">potxnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">)</span>
            <span class="c"># hack for rzphi</span>
            <span class="k">if</span> <span class="s">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">potxnames</span><span class="p">:</span>
                <span class="n">potxnames</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">potxnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">[</span><span class="n">potxnames</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">&lt;</span><span class="n">l</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span> 
                <span class="n">nd</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">[</span><span class="n">potxnames</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))</span><span class="o">&lt;</span><span class="n">l</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">nd</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c"># hack for pent</span>
            <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">potxnames</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;Lambda&#39;</span><span class="p">:</span>
                <span class="n">nd</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">potxnames</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;x&#39;</span><span class="p">:</span>
                <span class="n">nd</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c">#debug print(&quot;Determined dimensionality in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug start_time = time.time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">=</span> <span class="n">potxnames</span><span class="p">[:</span><span class="n">nd</span><span class="p">]</span>    
        <span class="n">x</span> <span class="o">=</span> <span class="n">fromtxt</span><span class="p">[</span><span class="n">potxnames</span><span class="p">[:</span><span class="n">nd</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="c"># can be any order</span>
        <span class="k">else</span><span class="p">:</span>    <span class="c"># Must be written in ascending order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">name</span><span class="p">])))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
        <span class="c">#debug print(&quot;Set x in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug print(&quot;shape = &quot;+str(self.shape))</span>
        <span class="c">#debug start_time = time.time()        </span>
        <span class="c"># reduce exesively large files, assuming 1st column is x</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">)</span><span class="o">&gt;</span><span class="n">maxlength</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">l</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">maxlength</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="n">l</span><span class="p">:</span>
                <span class="n">fromtxt</span> <span class="o">=</span> <span class="n">fromtxt</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span> <span class="c"># no axes to muck up</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
                <span class="n">mask</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="c">#debug print(&#39;set mask in {} seconds&#39;.format(time.time()-start_time))</span>
                <span class="n">fromtxt</span> <span class="o">=</span> <span class="n">fromtxt</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
            <span class="c">#debug print(&#39;masked fromtxt in {} seconds&#39;.format(time.time()-start_time))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING: Reducing length of &quot;</span>
                <span class="o">+</span><span class="s">&quot;table from {:} to {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">))</span>
                <span class="o">+</span><span class="s">&quot; by reducing x[0] by a factor of {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fromtxt</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">fromtxt</span><span class="p">[</span><span class="n">potxnames</span><span class="p">[:</span><span class="n">nd</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">name</span><span class="p">])))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
            <span class="c">#debug print(&quot;Set x in {} seconds&quot;.format(time.time()-start_time))</span>
            <span class="c">#debug start_time = time.time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pts</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">forcedim</span><span class="p">:</span>
            <span class="c">#debug print(len(self.pts),self.pts.shape)</span>
            <span class="n">forcedim</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">forcedim</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">forcedim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">newx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">newx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">newx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">newx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">newx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">2</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
        <span class="c">#debug print(&quot;Set pts in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug start_time = time.time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#debug print(self.shape,l)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="n">l</span><span class="p">:</span> <span class="c">#probably psi to closely packed</span>
            <span class="c"># maybe first axis is packed too tight, try trusting others</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][::</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span> <span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][::</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="c"># test result</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING: Irregular dependent data: can not form axes for interpolation.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Warning: Axes contain repeated values. Forced axes may be incorrect.&quot;</span><span class="p">)</span>
        <span class="c">#debug print(&quot;Checked axes in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug start_time = time.time()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;real&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;real&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">newname</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromtxt</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">fromtxt</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;real&#39;</span><span class="p">,</span><span class="s">&#39;imag&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">auto_complex</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s">&#39;|&#39;</span><span class="o">+</span><span class="n">newname</span><span class="o">+</span><span class="s">&#39;|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">newname</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s">&#39;angle &#39;</span><span class="o">+</span><span class="n">newname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">newname</span><span class="p">])</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="s">&#39;imag&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">fromtxt</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c">#debug print(&quot;Set y in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug start_time = time.time()</span>

        <span class="c">#scipy interpolation function for ND (stored so user can override)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="o">=</span><span class="p">{}</span>

        <span class="c"># Set any variables from preamble</span>
        <span class="n">preamble</span><span class="o">=</span><span class="n">preamble</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">params</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">preamble</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">):</span>    <span class="c">#paramter specifications</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">preamble</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;()[]{}\/*-+^%.,:!@#&amp;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="ow">and</span> <span class="n">idx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">preamble</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;()[]{}\/*-+^%.,:!@#&amp;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sfx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">name</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sfx</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">name</span><span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sfx</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">param</span><span class="p">)))</span> <span class="c">#if its a number</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="n">param</span><span class="p">))</span>        <span class="c">#if its not a number</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">preamble</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">preamble</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">preamble</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
            <span class="n">preamble</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">preamble</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>    <span class="c">#whatever is left</span>

        <span class="c">#debug print(&quot;Set preamble in {} seconds&quot;.format(time.time()-start_time))</span>
        <span class="c">#debug start_time = time.time()</span>


    <span class="c"># Operations overrides</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="nb">pow</span><span class="p">,</span><span class="s">&#39;^&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    

    <span class="c"># Built in interpolation</span>
<div class="viewcode-block" id="DataBase.interp"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate data to point(s).</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">          x  : ndarray shape (npts,ndim).</span>
<span class="sd">            Point(s) on dependent axis(axes).</span>
<span class="sd">        </span>
<span class="sd">        Key Word Arguments:</span>
<span class="sd">          ynames : list. </span>
<span class="sd">            Any number of keys from y attribute</span>
<span class="sd">          quiet  : bool. </span>
<span class="sd">            Suppres status messages</span>

<span class="sd">        Returns:</span>
<span class="sd">          dict. </span>
<span class="sd">            Each name contains array of interpolated data.  </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#housekeeping</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">(</span><span class="n">ynames</span><span class="p">,)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,]</span>
        <span class="n">NewData</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">pts</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">pts</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">xi</span><span class="p">)))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">NewData</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">NewData</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">NewData</span><span class="o">.</span><span class="n">pts</span><span class="p">):</span>
                <span class="n">NewData</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c">#function to form interpolator if needed</span>
        <span class="k">def</span> <span class="nf">new_interp</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Forming interpolator for &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span> <span class="c"># regular grid is fast</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="p">):</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">RegularGridInterpolator</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span><span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># irregular grid is slower but ok</span>
                <span class="n">step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1e6</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="p">):</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span><span class="n">n</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][::</span><span class="n">step</span><span class="p">])</span>

        <span class="c"># for each name check if interpolator is up to date and get values</span>
        <span class="n">values</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_interp</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_interp</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Interpolating values for &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpdict</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="n">NewData</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">return</span> <span class="n">NewData</span>
        
    
    <span class="c"># Built-in visualizations</span></div>
<div class="viewcode-block" id="DataBase.plot1d"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.plot1d">[docs]</a>    <span class="k">def</span> <span class="nf">plot1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x1rng</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x2rng</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x3rng</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Line plots of from 1D or 2D data.</span>
<span class="sd">        </span>
<span class="sd">        Key Word Arguments:</span>

<span class="sd">          ynames : list</span>
<span class="sd">            Strings specifying dependent data displayed.</span>
<span class="sd">          xname  : string</span>
<span class="sd">            The independent axis if 2D data.</span>
<span class="sd">          x1rng  : optional</span>
<span class="sd">            Valid formats are:</span>

<span class="sd">              - x               Plot single nearest point x-axis.</span>
<span class="sd">              - (xmin,xmax)     Plots all data in range (min,max). </span>
<span class="sd">              - (xmin,xmax,n)   Plots n evenly spaced points in range.</span>

<span class="sd">          x2rng  : . </span>
<span class="sd">            Same as x1rng. Applicable to 2D or 3D data.</span>
<span class="sd">          x3rng  : . </span>
<span class="sd">            Same as x2rng for 3D data only. Order of x is </span>
<span class="sd">            xnames with xname placed in front if given.</span>
<span class="sd">          squeeze : bool</span>
<span class="sd">            Plots all ynames in same axis.</span>
<span class="sd">            </span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            Valid matplotlib pyplot.plot keyword arguments.</span>

<span class="sd">        Returns:</span>

<span class="sd">          f : figure</span>
<span class="sd">            poloidal cross sections of plasma response</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># housekeeping</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">(</span><span class="n">ynames</span><span class="p">,)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xname</span><span class="p">:</span> <span class="n">xname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">]</span>

        <span class="c"># helper to sort through axes of ND data</span>
        <span class="k">def</span> <span class="nf">maskmaker</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">rng</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span> 
                <span class="n">mask</span> <span class="o">=</span> <span class="n">ax</span><span class="o">==</span><span class="n">ax</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">-</span><span class="n">rng</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax</span><span class="o">&gt;=</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span><span class="o">&lt;=</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Warning: mapping all axes to regular grid.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">():</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">():</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">rng</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Griding for 3D data is under developement.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span><span class="p">,</span><span class="n">mask</span>
        
        <span class="c"># display data</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s">&#39;axes&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">squeeze</span><span class="p">:</span>
                <span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span>  <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcp_size</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span><span class="n">nrow</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">squeeze</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">))</span>

        <span class="k">if</span> <span class="s">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ulbl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;, &#39;</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ulbl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">ynames</span><span class="p">):</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">ulbl</span> <span class="o">+</span> <span class="n">_mathtext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="n">x2</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">indx</span><span class="p">)</span>
                    <span class="n">xlbl</span> <span class="o">=</span> <span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">rng2</span><span class="p">],</span><span class="n">x2</span><span class="p">[</span><span class="n">rng2</span><span class="p">]):</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">rng1</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x1rng</span><span class="p">)</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbl</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x2s</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">xlbl</span> <span class="o">=</span> <span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">x2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x2s</span><span class="p">[</span><span class="n">rng2</span><span class="p">])))</span>
                    <span class="k">for</span> <span class="n">x2</span> <span class="ow">in</span> <span class="n">x2s</span><span class="p">:</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))))</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">rng1</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x1rng</span><span class="p">)</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbl</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">indx23</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">indx23</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="n">x2</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx23</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">x3</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x3rng</span><span class="p">)</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">indx</span><span class="p">)</span>
                    <span class="n">xlbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span> <span class="k">if</span> <span class="n">name</span><span class="o">!=</span><span class="n">xname</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">y2</span><span class="p">,</span><span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">rng2</span><span class="p">],</span><span class="n">x2</span><span class="p">[</span><span class="n">rng2</span><span class="p">]):</span>
                        <span class="n">x2lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">x3</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y2</span><span class="p">[</span><span class="n">rng3</span><span class="p">],</span><span class="n">x3</span><span class="p">[</span><span class="n">rng3</span><span class="p">]):</span>
                            <span class="n">x</span><span class="p">,</span><span class="n">rng1</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x1rng</span><span class="p">)</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">x2lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x3</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x2s</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">x2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x2s</span><span class="p">[</span><span class="n">rng2</span><span class="p">])))</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                    <span class="n">xlbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span> <span class="k">for</span> <span class="n">xlbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span> <span class="k">if</span> <span class="n">xlbl</span><span class="o">!=</span><span class="n">xname</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">x2</span> <span class="ow">in</span> <span class="n">x2s</span><span class="p">:</span>
                        <span class="n">x2lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
                        <span class="n">x3s</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">rng2</span><span class="p">],</span><span class="n">x3rng</span><span class="p">)</span>
                        <span class="n">x3s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x3s</span><span class="p">[</span><span class="n">rng3</span><span class="p">])))</span>
                        <span class="k">for</span> <span class="n">x3</span> <span class="ow">in</span> <span class="n">x3s</span><span class="p">:</span>
                            <span class="n">x3d</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">rng2</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x3</span><span class="p">))</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">rng3</span><span class="p">]</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="n">rng3</span><span class="p">]</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))))</span>
                            <span class="n">x</span><span class="p">,</span><span class="n">rng1</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x1rng</span><span class="p">)</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">rng1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">x2lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x3</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="p">]))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span>
                              </div>
<div class="viewcode-block" id="DataBase.plot2d"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.plot2d">[docs]</a>    <span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="s">&#39;imshow&#39;</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
               <span class="n">center</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">grid_size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">),</span><span class="n">swap</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matplotlib 2D plots of the data.</span>
<span class="sd">        </span>
<span class="sd">        Key Word Arguments:</span>
<span class="sd">          ynames : list. </span>
<span class="sd">            Strings specifying dependent data displayed.</span>
<span class="sd">          aspect : str/float. </span>
<span class="sd">            Choose from &#39;auto&#39; or &#39;equal&#39; (see matplotlib axes.set_aspect).</span>
<span class="sd">            A float stretches a circle to hight=aspect*width. </span>
<span class="sd">          plot_type: str. </span>
<span class="sd">            Choose one of:</span>
<span class="sd">            </span>
<span class="sd">            - &quot;imshow&quot; Use matplotlib imshow to plot on grid.</span>
<span class="sd">            - &quot;pcolormesh&quot; Use matplotlib pcolormesh to plot on grid.</span>
<span class="sd">            - &quot;contour&quot;    Use matplotlib contour to plot on grid.</span>
<span class="sd">            - &quot;contourf&quot;   Use matplotlib contourf to plot on grid.</span>
<span class="sd">            - &quot;tripcolor&quot;  Use matplotlib tripcolor to plot raw points.</span>
<span class="sd">            - &quot;tripcontour&quot;  Use matplotlib tripcontour to plot raw points.</span>
<span class="sd">            - &quot;tripcontourf&quot; Use matplotlib tripcontourf to plot raw points.</span>

<span class="sd">          cbar   : bool. </span>
<span class="sd">            Show colorbar.</span>
<span class="sd">          grid_size : tuple. </span>
<span class="sd">            Size of grid used if no regular axes x (in order of xnames).</span>
<span class="sd">          swap   : bool. </span>
<span class="sd">            Swap x/y axes.</span>
<span class="sd">          kwargs : dict. </span>
<span class="sd">            Valid pcolormesh/contour/contourf key arguments.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">          figure. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">[</span><span class="n">ynames</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&quot;Data not 2D.&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="o">.</span><span class="n">T</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;imshow&#39;</span><span class="p">,</span><span class="s">&#39;pcolormesh&#39;</span><span class="p">,</span><span class="s">&#39;contour&#39;</span><span class="p">,</span><span class="s">&#39;contourf&#39;</span><span class="p">]:</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span><span class="mi">1j</span><span class="o">*</span><span class="n">grid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span><span class="mi">1j</span><span class="o">*</span><span class="n">grid_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">grid_size</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">step</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Reducing data by factor of {:}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">ynames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">ynames</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;imag &#39;</span><span class="o">+</span><span class="n">name</span>
                    <span class="n">ynames</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="s">&#39;real &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c"># looks at new names -&gt; KeyError</span>
                <span class="k">pass</span>

        <span class="c"># display data</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span>
        <span class="k">elif</span> <span class="s">&#39;axes&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span>  <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcp_size</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span><span class="n">nrow</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">ynames</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Plotting &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">plot_type</span><span class="p">)</span>
            <span class="c">#if(plot_type==&#39;line&#39;):</span>
            <span class="c">#    #plotter = getattr(a,&#39;trip&#39;*bool(self.x)+&#39;contour&#39;)</span>
            <span class="c">#    plotter=a.contour</span>
            <span class="c">#elif(plot_type==&#39;fill&#39;):</span>
            <span class="c">#    #plotter = getattr(a,&#39;trip&#39;*bool(self.x)+&#39;contourf&#39;)</span>
            <span class="c">#    plotter=a.contourf</span>
            <span class="c">#else:</span>
            <span class="c">#    if self.x:</span>
            <span class="c">#        plotter = a.pcolormesh</span>
            <span class="c">#    else:</span>
            <span class="c">#        plotter = a.tripcolor</span>

            <span class="c"># convert to reals and grid if necessary</span>
            <span class="n">reducedname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;real &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;imag &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;imag &#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">reducedname</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">reducedname</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x1</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x1</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">raw</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">raw</span><span class="p">),(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">swap</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">T</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_set_color_defaults</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c"># plot type specifics</span>
            <span class="k">if</span> <span class="n">plotter</span><span class="o">==</span><span class="n">a</span><span class="o">.</span><span class="n">imshow</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;origin&#39;</span><span class="p">,</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;aspect&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">aspect</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;extent&#39;</span><span class="p">,[</span><span class="n">x1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">x2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x2</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span><span class="s">&#39;gaussian&#39;</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">plotter</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">]:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;shading&#39;</span><span class="p">,</span><span class="s">&#39;gouraud&#39;</span><span class="p">)</span>
            <span class="n">pcm</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="n">swap</span><span class="p">]))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">swap</span><span class="p">]))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x1</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span>
</div>
<div class="viewcode-block" id="DataBase.plot3d"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.plot3d">[docs]</a>    <span class="k">def</span> <span class="nf">plot3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;psi&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">cbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">),</span>
               <span class="n">plot_type</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">phi</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Three dimensional plots. Data with xnames r,z will be plotted</span>
<span class="sd">        with third dimension phi where Y = Re[y]cos(n*phi)+Im[y]sin(n*phi).</span>

<span class="sd">            1D data &gt; lines in a plane in 3-space.</span>
<span class="sd">            2D data &gt; z axis becomes y value</span>
<span class="sd">            3D data &gt; chosen display type</span>

<span class="sd">        Must have mayavi.mlab module available in pythonpath.</span>
<span class="sd">        </span>
<span class="sd">        *Key Word Arguments:*</span>
<span class="sd">          ynames   : list. </span>
<span class="sd">            Strings specifying dependent data displayed.</span>
<span class="sd">          filter   : dict. </span>
<span class="sd">            Filter points as only those closest to this y value.</span>
<span class="sd">          cbar : bool.</span>
<span class="sd">            Display a vertical colorbar in the Mayavi Scene.</span>
<span class="sd">          size : tuple.</span>
<span class="sd">            Size of figure in pixels.</span>
<span class="sd">          plot_type : str. </span>
<span class="sd">            Valid mayavi.mlab function name. </span>
<span class="sd">            Overrides default function choices (plot3d,mesh,quiver3d).</span>
<span class="sd">          phi : ndarray.</span>
<span class="sd">            Toroidal angle grid for complex 2D data. Default is 360 degrees, 180 pts.</span>
<span class="sd">          center : float.</span>
<span class="sd">            Center colormap on this value.</span>

<span class="sd">        *Returns:*</span>
<span class="sd">          figure.</span>
<span class="sd">          </span>
<span class="sd">          </span>
<span class="sd">        *Example:*</span>
<span class="sd">        </span>
<span class="sd">        xb, = data.read(&#39;examples/DIIID_example/ipec_xbnormal_fun_n1.out&#39;,forcex=[&#39;r&#39;,&#39;z&#39;])</span>
<span class="sd">        xb.plot3d(&#39;bno&#39;)</span>
<span class="sd">        </span>
<span class="sd">        ..note: I think what we usually want out of IPEC is</span>
<span class="sd">        the 3D surface perturbation. If we run with fun_flag</span>
<span class="sd">        xn, = data.read(&#39;ipec_xbnormal_fun_n2.out&#39;)</span>
<span class="sd">        psi = 1.0</span>
<span class="sd">        n = 2</span>
<span class="sd">        fltr= xb.y[&#39;psi&#39;]==xb.y[&#39;psi&#39;][np.abs(xb.y[&#39;psi&#39;]-psi).argmin()]</span>
<span class="sd">        r,z,p = xb.pts[:,0][fltr],xb.pts[:,1][fltr],np.linspace(0,2*np.pi,60)</span>
<span class="sd">        s = xb.y[&#39;bno&#39;][fltr]</span>
<span class="sd">        cx = r.reshape(-1,1)*np.exp(1j*p.reshape(1,-1))</span>
<span class="sd">        X,Y = cx.real,cx.imag</span>
<span class="sd">        Z = z.reshape(-1,1)*np.ones_like(X)</span>
<span class="sd">        S = (s.reshape(-1,1)*np.exp(-n*1j*p.reshape(1,-1))).real</span>
<span class="sd">        mmlab.figure(fgcolor=(0, 0, 0), bgcolor=(1, 1, 1))</span>
<span class="sd">        mmlab.mesh(X, Y, Z, scalars=S) #, colormap=&#39;YlGnBu&#39;</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">[</span><span class="n">ynames</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mmlab</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;Unable to import mayavi.mlab.&quot;</span><span class="p">)</span>

        <span class="c"># the correct 3d plotting function</span>
        <span class="n">plotfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mmlab</span><span class="p">,[</span><span class="s">&#39;plot3d&#39;</span><span class="p">,</span><span class="s">&#39;mesh&#39;</span><span class="p">,</span><span class="s">&#39;quiver3d&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">plot_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plot_type</span><span class="o">==</span><span class="s">&#39;volume&#39;</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">plotfunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">sc</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">volume</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">thr</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;x_axes&#39;</span><span class="p">)</span>
                    <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">thr</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;y_axes&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mmlab</span><span class="p">,</span><span class="n">plot_type</span><span class="p">)</span>
                

        <span class="c"># filter data by other y variable</span>
        <span class="n">fltr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">fltr</span><span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="nb">filter</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
        
        <span class="c"># general multidimensional axes</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[</span><span class="n">fltr</span><span class="p">,:])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="c"># Extra work to convert the cylindrical axes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
            <span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">fltr</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">fltr</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phi</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c"># Added for more custamization</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">XY</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">XY</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">XY</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span>
        
        <span class="c"># display data</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">fltr</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
            <span class="k">if</span> <span class="n">plotfunc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mmlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span><span class="n">mmlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">]:</span>
                <span class="n">XYZ</span> <span class="o">=</span> <span class="n">X</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;scalars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">XYZ</span> <span class="o">=</span> <span class="n">X</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c">#print(np.array(XYZ).shape)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_set_color_defaults</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;viridis&#39;</span><span class="p">:</span><span class="s">&#39;YlGnBu&#39;</span><span class="p">}</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cmap&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;_r&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colormap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;_r&#39;</span><span class="p">)</span>
            <span class="n">plotobj</span> <span class="o">=</span> <span class="n">plotfunc</span><span class="p">(</span><span class="o">*</span><span class="n">XYZ</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span> <span class="n">plotobj</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">scalar_lut_manager</span><span class="o">.</span><span class="n">reverse_lut</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span> <span class="c">#X,S</span>
    
</div>
<div class="viewcode-block" id="DataBase.scatter"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.scatter">[docs]</a>    <span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scatter plot display for non-regular data. Display mimics plot1d in t</span>
<span class="sd">        hat it displays a single independent axis. If is another independent </span>
<span class="sd">        axis exists, and is not sliced using one of the optional keyword arguments, </span>
<span class="sd">        it s represented as the color of the plotted symbols. If the data is 3D </span>
<span class="sd">        and unsliced, preference if given in order of xnames.</span>

<span class="sd">        Arguments:     </span>
<span class="sd">          ynames : list.</span>
<span class="sd">            Dependent data to be displayed. Default is all y data.</span>
<span class="sd">          xname  : str.</span>
<span class="sd">            Independent axis used in scatter plots. Default is first in xnames.</span>
<span class="sd">          x1     : float.</span>
<span class="sd">            Use only data with first axis clossest to value.</span>
<span class="sd">          x2     : float.</span>
<span class="sd">            Use only data with second axis clossest to value.</span>
<span class="sd">          x3     : float.</span>
<span class="sd">            Use only data with thrid axis clossest to value.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">          figure</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">[</span><span class="n">ynames</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xname</span><span class="p">:</span> <span class="n">xname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xname</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">ylbl</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="n">indx2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="p">)</span>
        <span class="n">indx2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x1</span><span class="p">:</span> 
            <span class="n">indx2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="n">ylbl</span><span class="o">+=</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
            <span class="n">rng</span><span class="o">*=</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">x1</span>
        <span class="k">if</span> <span class="n">x2</span><span class="p">:</span> 
            <span class="n">indx2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="n">ylbl</span><span class="o">+=</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
            <span class="n">rng</span><span class="o">*=</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">x2</span>
        <span class="k">if</span> <span class="n">x3</span><span class="p">:</span> 
            <span class="n">indx2</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="n">ylbl</span><span class="o">+=</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span>
            <span class="n">rng</span><span class="o">*=</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">x3</span>
        <span class="k">if</span> <span class="n">indx2</span><span class="p">:</span> 
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx2</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">rng</span><span class="p">]</span>
            <span class="n">cset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">clbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="n">rng</span><span class="p">])</span>
            <span class="n">clbl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c">#double number of axes for complex data</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">ynames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">ynames</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;imag &#39;</span><span class="o">+</span><span class="n">name</span>
                    <span class="n">ynames</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="s">&#39;real &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c"># looks at new names -&gt; KeyError</span>
                <span class="k">pass</span>
        <span class="c"># actual plotting</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span>
        <span class="k">elif</span> <span class="s">&#39;axes&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span>  <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcp_size</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span><span class="n">nrow</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">ynames</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;if &#39;real&#39; in name:</span>
<span class="sd">                sc=a.scatter(self.pts[:,indx][rng],np.real(self.y[name.replace(&#39;real &#39;,&#39;&#39;)][rng]),</span>
<span class="sd">                         c=c,cmap=plt.matplotlib.cm.gist_rainbow,**kwargs)</span>
<span class="sd">            elif &#39;imag&#39; in name:</span>
<span class="sd">                sc=a.scatter(self.pts[:,indx][rng],np.imag(self.y[name.replace(&#39;imag &#39;,&#39;&#39;)][rng]),</span>
<span class="sd">                         c=c,cmap=plt.matplotlib.cm.gist_rainbow,**kwargs)</span>
<span class="sd">            else:</span>
<span class="sd">                sc=a.scatter(self.pts[:,indx][rng],np.real(self.y[name][rng]),</span>
<span class="sd">                         c=c,cmap=plt.matplotlib.cm.gist_rainbow,**kwargs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;real &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;imag &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)][</span><span class="n">rng</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;real&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;imag&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">sc</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_rainbow</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c"># for printing purposes</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">])</span>
            <span class="n">a</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="p">]))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="n">ylbl</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">clbl</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">cset</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">clbl</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span>
</div>
<div class="viewcode-block" id="DataBase.slice"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.DataBase.slice">[docs]</a>    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="p">[]):</span><span class="c">#npts=100,**kwargs):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        UNDER CONSTRUCTION</span>

<span class="sd">        Return 1D data object from 2D. Method grids new data, </span>
<span class="sd">        so beware of loosing accuracy near rational surfaces.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:    </span>
<span class="sd">          x       : float. </span>
<span class="sd">            Lower bound of the axis.</span>
<span class="sd">            </span>
<span class="sd">        Key Word Arguments:</span>
<span class="sd">          xname   : str. </span>
<span class="sd">            Axis allong which slice is performed.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">          obj. </span>
<span class="sd">            New data nd-1 dimensional data object.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># housekeeping</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">(</span><span class="n">ynames</span><span class="p">,)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xname</span><span class="p">:</span> <span class="n">xname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xname</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">]</span>

        <span class="c"># helper to sort through axes of ND data</span>
        <span class="k">def</span> <span class="nf">maskmaker</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">rng</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span> 
                <span class="n">mask</span> <span class="o">=</span> <span class="n">ax</span><span class="o">==</span><span class="n">ax</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">-</span><span class="n">rng</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax</span><span class="o">&gt;=</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span><span class="o">&lt;=</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Warning: mapping all axes to regular grid.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">():</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">():</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">rng</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Griding for 3D data is under developement.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span><span class="p">,</span><span class="n">mask</span>
        
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">ynames</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="n">x2</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">indx</span><span class="p">)</span>
                    <span class="n">xlbl</span> <span class="o">=</span> <span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">rng2</span><span class="p">],</span><span class="n">x2</span><span class="p">[</span><span class="n">rng2</span><span class="p">]):</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbl</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x2s</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">xlbl</span> <span class="o">=</span> <span class="n">_mathtext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="p">[</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">x2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x2s</span><span class="p">[</span><span class="n">rng2</span><span class="p">])))</span>
                    <span class="k">for</span> <span class="n">x2</span> <span class="ow">in</span> <span class="n">x2s</span><span class="p">:</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbl</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">indx23</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">indx23</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="n">x2</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx23</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">x3</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x3rng</span><span class="p">)</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">indx</span><span class="p">)</span>
                    <span class="n">xlbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span> <span class="k">if</span> <span class="n">name</span><span class="o">!=</span><span class="n">xname</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">y2</span><span class="p">,</span><span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">rng2</span><span class="p">],</span><span class="n">x2</span><span class="p">[</span><span class="n">rng2</span><span class="p">]):</span>
                        <span class="n">x2lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">x3</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y2</span><span class="p">[</span><span class="n">rng3</span><span class="p">],</span><span class="n">x3</span><span class="p">[</span><span class="n">rng3</span><span class="p">]):</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">x2lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x3</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x2s</span><span class="p">,</span><span class="n">rng2</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">x2rng</span><span class="p">)</span>
                    <span class="n">x2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x2s</span><span class="p">[</span><span class="n">rng2</span><span class="p">])))</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                    <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">rng2</span><span class="p">]</span>
                    <span class="n">xlbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">_mathtext</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span> <span class="k">for</span> <span class="n">xlbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span> <span class="k">if</span> <span class="n">xlbl</span><span class="o">!=</span><span class="n">xname</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">x2</span> <span class="ow">in</span> <span class="n">x2s</span><span class="p">:</span>
                        <span class="n">x2lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
                        <span class="n">x3s</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">rng2</span><span class="p">],</span><span class="n">x3rng</span><span class="p">)</span>
                        <span class="n">x3s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x3s</span><span class="p">[</span><span class="n">rng3</span><span class="p">])))</span>
                        <span class="k">for</span> <span class="n">x3</span> <span class="ow">in</span> <span class="n">x3s</span><span class="p">:</span>
                            <span class="n">x3d</span><span class="p">,</span><span class="n">rng3</span> <span class="o">=</span> <span class="n">maskmaker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="n">indx23</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">rng2</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x3</span><span class="p">))</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">rng3</span><span class="p">]</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="n">rng3</span><span class="p">]</span>
                            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">x2lbl</span><span class="o">+</span><span class="s">&#39;, &#39;</span><span class="o">+</span><span class="n">xlbls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;={0:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x3</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    
    





<span class="c">######################################################## helper functions</span>

<span class="c">##class operations</span>
</div></div>
<span class="k">def</span> <span class="nf">_data_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">fun</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="n">default_quiet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generalizes the process of creating a new class</span>
<span class="sd">    and filling it with the appropriate dependent data, info, and</span>
<span class="sd">    indepenedent data from an operation on one or more data classes.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NewData</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c">#intialize new data object.</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">==</span><span class="n">DataBase</span><span class="p">:</span>
        <span class="c"># check if same dependent variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">xnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s">&#39;Two data objects do not have same dependent variables.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">pts</span><span class="p">):</span><span class="c">#[np.all(sx==ox) for sx,ox in zip(self.x,other.x)]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;interpolating to same axes.&#39;</span><span class="p">)</span>
            <span class="n">otherinterp</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">NewData</span><span class="o">.</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">otherinterp</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
        <span class="c"># problem from unbound interpolation?? Fixed when switched to returning objects.</span>
        <span class="c">#if self.nd==1:</span>
        <span class="c">#    for k in otherinterp:</span>
        <span class="c">#        otherinterp[k] = otherinterp[k].ravel()</span>
            
    
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
                <span class="c">#if not quiet: print(key+op+key)</span>
                <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">otherinterp</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">op</span><span class="o">+</span><span class="n">key</span><span class="p">)</span>
                <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">otherinterp</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span><span class="n">otherinterp</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="n">op</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c"># apply operation to y values</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c">#if not quiet: print(k+op+str(other))</span>
            <span class="n">NewData</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">other</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">NewData</span>




<span class="k">def</span> <span class="nf">_mathtext</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert lazy ascii conventions to </span>
<span class="sd">    nicer latex strings.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">      text : str.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">simplemaps</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;epsilon&#39;</span><span class="p">,</span><span class="s">&#39;psi&#39;</span><span class="p">,</span><span class="s">&#39;omega&#39;</span><span class="p">,</span><span class="s">&#39;nabla&#39;</span><span class="p">,</span><span class="s">&#39;cdot&#39;</span><span class="p">,</span><span class="s">&#39;kappa&#39;</span><span class="p">,</span><span class="s">&#39;vartheta&#39;</span><span class="p">,</span><span class="s">&#39;theta&#39;</span><span class="p">,</span>
                  <span class="s">&#39;nu&#39;</span><span class="p">,</span><span class="s">&#39;times&#39;</span><span class="p">,</span><span class="s">&#39;perp&#39;</span><span class="p">,</span><span class="s">&#39;parallel&#39;</span><span class="p">,</span><span class="s">&#39;lambda&#39;</span><span class="p">,</span><span class="s">&#39;ln&#39;</span><span class="p">,</span>
                  <span class="s">&#39;Lambda&#39;</span><span class="p">,</span><span class="s">&#39;xi&#39;</span><span class="p">,</span><span class="s">&#39;chi&#39;</span><span class="p">,</span><span class="s">&#39;varphi&#39;</span><span class="p">,</span><span class="s">&#39;phi&#39;</span><span class="p">,</span><span class="s">&#39;Phi&#39;</span><span class="p">,</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;Re&#39;</span><span class="p">,</span><span class="s">&#39;Im&#39;</span><span class="p">,</span>
                  <span class="s">&#39;delta&#39;</span><span class="p">,</span><span class="s">&#39;angle&#39;</span><span class="p">,</span><span class="s">&#39;ell&#39;</span><span class="p">,</span><span class="s">&#39;alpha&#39;</span><span class="p">,</span><span class="s">&#39;beta&#39;</span><span class="p">,</span><span class="s">&#39;zeta&#39;</span><span class="p">,</span><span class="s">&#39;rho&#39;</span><span class="p">]</span>
    
    <span class="n">trickymaps</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;par&#39;</span><span class="p">,</span><span class="s">&#39;parallel&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;divxprp&#39;</span><span class="p">,</span><span class="s">&#39;nablacdotxi_perp&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;exb&#39;</span><span class="p">,</span><span class="s">&#39;EtimesB&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lmda&#39;</span><span class="p">,</span><span class="s">&#39;lambda&#39;</span><span class="p">),</span><span class="c">#(&#39;lam&#39;,&#39;lambda&#39;),</span>
                  <span class="p">(</span><span class="s">&#39;wdian&#39;</span><span class="p">,</span><span class="s">&#39;omega_*n&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;wdiat&#39;</span><span class="p">,</span><span class="s">&#39;omega_{*T}&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;wrot&#39;</span><span class="p">,</span><span class="s">&#39;omega_phi&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;real&#39;</span><span class="p">,</span><span class="s">&#39;Re&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;imag&#39;</span><span class="p">,</span><span class="s">&#39;Im&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span><span class="s">&#39;ln&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;ln10&#39;</span><span class="p">,</span><span class="s">&#39;log_{10}&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;kxprp&#39;</span><span class="p">,</span><span class="s">&#39;kappacdotxi_perp&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;prp&#39;</span><span class="p">,</span><span class="s">&#39;perp&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">,</span><span class="s">&#39;int &#39;</span><span class="p">),(</span><span class="s">&#39;eps_&#39;</span><span class="p">,</span><span class="s">&#39;epsilon_&#39;</span><span class="p">)</span>
                 <span class="p">]</span>

    <span class="c"># replace some lazy data labeling with proper math</span>
    <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">trickymaps</span><span class="p">:</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">*</span><span class="n">tm</span><span class="p">)</span>
    <span class="c"># tex up symbols</span>
    <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="n">simplemaps</span><span class="p">:</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="s">&quot;$</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">+</span><span class="n">sm</span><span class="o">+</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
    <span class="c"># clean up known bugs</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;e$</span><span class="se">\\</span><span class="s">psi$lon&#39;</span><span class="p">,</span><span class="s">&#39;epsilon&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;var$</span><span class="se">\\</span><span class="s">theta&#39;</span><span class="p">,</span><span class="s">&#39;vartheta&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;var$</span><span class="se">\\</span><span class="s">phi&#39;</span><span class="p">,</span><span class="s">&#39;varphi&#39;</span><span class="p">)</span>
    <span class="c"># deliniate start/stop of latexing</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
        <span class="c">#if &#39;_&#39; in word: # got too fancy (required spaces after subscripts)</span>
        <span class="c">#    newword=&#39;$&#39;+word.replace(&#39;_&#39;,&#39;_{&#39;).replace(&#39;$&#39;,&#39;&#39;)+&#39;}&#39;*word.count(&#39;_&#39;)+&#39;$&#39;</span>
        <span class="k">if</span> <span class="s">&#39;^&#39;</span> <span class="ow">in</span> <span class="n">word</span> <span class="ow">or</span> <span class="s">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="s">&#39;$&#39;</span><span class="o">+</span><span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
    <span class="c">#text.replace(&#39;$$&#39;,&#39;&#39;)</span>
    
    <span class="k">return</span> <span class="n">text</span><span class="c">#.encode(&#39;string-escape&#39;) #raw string</span>

<div class="viewcode-block" id="getshot"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.getshot">[docs]</a><span class="k">def</span> <span class="nf">getshot</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">full_name</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find 6 digit shot number in path to directory</span>
<span class="sd">    or file.</span>
<span class="sd">    </span>
<span class="sd">    **Arguments:**</span>
<span class="sd">      </span>
<span class="sd">    **Key Word Arguments:**</span>
<span class="sd">      d : str.</span>
<span class="sd">        Path.</span>
<span class="sd">    **Returns:**</span>
<span class="sd">      str.</span>
<span class="sd">        Shot number if found, &#39;&#39; if not.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pth</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">shot</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shot</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pth</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]))</span>
            <span class="k">break</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">full_name</span><span class="p">:</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="n">pth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">shot</span> <span class="o">=</span> <span class="n">d</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">shot</span>
</div>
<div class="viewcode-block" id="add_control_geometry"><a class="viewcode-back" href="../../source_documentation.html#pypec.data.add_control_geometry">[docs]</a><span class="k">def</span> <span class="nf">add_control_geometry</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add geometric dimensions to dataset from ipec_control_output_n#.nc.</span>

<span class="sd">    **Arguments:**</span>
<span class="sd">        ds : Dataset. xarray Dataset opened from ipec_control_output_n#.nc</span>

<span class="sd">    **Key Word Arguments:**</span>
<span class="sd">        overwrite : bool. Overwrite geometric quantities if they already exist.</span>

<span class="sd">    **Examples:**</span>

<span class="sd">    After opening, and adding geometry,</span>
<span class="sd">    &gt;&gt;&gt; ds = open_dataset(&#39;examples/DIIID_example/ipec_control_output_n1.nc&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ds = add_control_geometry(ds)</span>
<span class="sd">    </span>
<span class="sd">    it is easy to make 3D surface plots using mayavi,</span>
<span class="sd">    &gt;&gt;&gt; fig = mmlab.figure(bgcolor=(1,1,1),fgcolor=(0,0,0),size=(600,600))</span>
<span class="sd">    &gt;&gt;&gt; mesh = mmlab.mesh(ds[&#39;X&#39;].values,ds[&#39;Y&#39;].values,ds[&#39;Z&#39;].values,</span>
<span class="sd">    ...                   scalars=np.real(ds[&#39;b_n&#39;]*ds[&#39;expn&#39;]),colormap=&#39;RdBu&#39;,figure=fig)</span>
<span class="sd">    &gt;&gt;&gt; mmlab.savefig(filename=&#39;example/example_3d_bn.png&#39;,figure=fig)</span>

<span class="sd">    .. image:: examples/example_3d_bn.png</span>
<span class="sd">       :width: 600px</span>

<span class="sd">    Make 2D perturbed last-closed-flux-surface plots quickly using,</span>
<span class="sd">    &gt;&gt;&gt; fac = 1e-1 # good for DIII-D unit eigenmodes</span>
<span class="sd">    &gt;&gt;&gt; f,ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.set_aspect(&#39;equal&#39;)</span>
<span class="sd">    &gt;&gt;&gt; l, = ax.plot(ds[&#39;R&#39;],ds[&#39;z&#39;],color=&#39;k&#39;)</span>
<span class="sd">    &gt;&gt;&gt; for i in range(4): # most and least stable modes</span>
<span class="sd">    ...     v = np.real(ds[&#39;R_EDX_FUN&#39;][i]*fac)</span>
<span class="sd">    ...     l, = ax.plot(ds[&#39;R&#39;]+v*ds[&#39;R_n&#39;],ds[&#39;z&#39;]+v*ds[&#39;z_n&#39;])</span>
<span class="sd">    &gt;&gt;&gt; sm = plt.set_linearray(ax.lines[-4:],cmap=&#39;viridis&#39;)</span>
<span class="sd">    &gt;&gt;&gt; cb = f.colorbar(sm,ticks=range(4))</span>
<span class="sd">    &gt;&gt;&gt; cb.set_label(&#39;Mode Index&#39;)</span>
<span class="sd">    &gt;&gt;&gt; xtl = ax.set_xticks([1,1.7,2.4])</span>
<span class="sd">    &gt;&gt;&gt; txt = ax.set_xlabel(&#39;R (m)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; txt = ax.set_ylabel(&#39;z (m)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; f.savefig(&#39;examples/example_boundary_wiggle.png&#39;)</span>

<span class="sd">    .. image:: examples/example_boundary_wiggle.png</span>
<span class="sd">       :width: 600px</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Toroidal angle</span>
    <span class="k">if</span> <span class="s">&#39;phi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;phi&#39;</span><span class="p">:</span><span class="n">phi</span><span class="p">})</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;expn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1j</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;phi&#39;</span><span class="p">])</span>

    <span class="c"># 3D cartesian coords for 3D plots</span>
    <span class="k">if</span> <span class="s">&#39;X&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;phi&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;xy&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xy</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">)[</span><span class="s">&#39;xy&#39;</span><span class="p">]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xy</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">)[</span><span class="s">&#39;xy&#39;</span><span class="p">]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;phi&#39;</span><span class="p">])</span>

    <span class="c"># Normal vectors</span>
    <span class="k">if</span> <span class="s">&#39;z_n&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">or</span> <span class="s">&#39;R_n&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dr</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;z_n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dr</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">())</span>
        <span class="n">ds</span><span class="p">[</span><span class="s">&#39;R_n&#39;</span><span class="p">]</span> <span class="o">=-</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dz</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">ds</span>

<span class="c">######################################################## Developer functions</span>

</div>
<span class="k">def</span> <span class="nf">_write_ellipk</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mf">3e2</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s">&#39;ellipk01.dat&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes complete elliptic integral of the first </span>
<span class="sd">    kind to file.</span>

<span class="sd">    .. note:: This is not the original routine. Could not find it.</span>

<span class="sd">    Key Word Arguments: </span>
<span class="sd">      npts : int.</span>
<span class="sd">      fname: str.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># ellipk(1-1e-17)=inf</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">1e-15</span><span class="p">)</span>
    <span class="n">kappas</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">npts</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{:.0f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npts</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kappas</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{:.21} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kappas</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ellipk</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">_write_ellipe</span><span class="p">(</span><span class="n">npts</span><span class="o">=</span><span class="mf">3e2</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s">&#39;ellipe01.dat&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes complete elliptic integral of the first </span>
<span class="sd">    kind to file.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: This is not the original routine. Could not find it.</span>
<span class="sd">    </span>
<span class="sd">    Key Word Arguments:</span>
<span class="sd">      npts : int.</span>
<span class="sd">      fname: str.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kappas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">npts</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{:.0f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npts</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kappas</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kappas</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ellipe</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
    <span class="k">return</span> <span class="bp">True</span>
        
<span class="k">def</span> <span class="nf">_factors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">reduce</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">__add__</span><span class="p">,</span> 
                      <span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">//</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
                       <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))))</span>

<span class="k">def</span> <span class="nf">_plot3dvolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">npts</span><span class="o">=</span><span class="mi">124</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Under construction volume plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># general multidimensional axes</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="c"># Extra work to convert the cylindrical axes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
        <span class="c"># regularly spaced grid in x,y,z</span>
        <span class="n">rlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">zlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="n">rlim</span><span class="p">:</span><span class="n">rlim</span><span class="p">:</span><span class="n">npts</span><span class="o">*</span><span class="mi">1j</span><span class="p">,</span><span class="o">-</span><span class="n">rlim</span><span class="p">:</span><span class="n">rlim</span><span class="p">:</span><span class="n">npts</span><span class="o">*</span><span class="mi">1j</span><span class="p">,</span><span class="o">-</span><span class="n">zlim</span><span class="p">:</span><span class="n">zlim</span><span class="p">:</span><span class="n">npts</span><span class="o">*</span><span class="mi">1j</span><span class="p">]</span>
        <span class="n">rr</span> 	 <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xx</span><span class="o">**</span><span class="mf">2.0</span><span class="o">+</span><span class="n">xx</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">]</span>
    
        <span class="c"># To index coordinates</span>
        <span class="n">cordpts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">npts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rr</span><span class="o">-</span><span class="n">rlim</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rlim</span><span class="p">),(</span><span class="n">npts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">zz</span><span class="o">-</span><span class="n">zlim</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">zlim</span><span class="p">)]</span>
    
    <span class="c"># display data</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
            
            <span class="c"># 2D interpolation</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;interpolating real component...&#39;</span><span class="p">)</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]),(</span><span class="n">rr</span><span class="p">,</span><span class="n">zz</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;interpolating imag component...&#39;</span><span class="p">)</span>
            <span class="n">S</span><span class="o">+=</span> <span class="n">griddata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">]),(</span><span class="n">rr</span><span class="p">,</span><span class="n">zz</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">1j</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">pp</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">S</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">rr</span><span class="p">))</span>
            <span class="c"># Take out wedge for better view</span>
            <span class="n">wedge</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yy</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="c">#m[wedge==False] = 0.0</span>
            <span class="n">S</span><span class="p">[</span><span class="n">wedge</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e99</span>
            <span class="n">S</span><span class="p">[(</span><span class="n">S</span><span class="o">==</span><span class="n">S</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mf">1e99</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
            <span class="n">thr</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">low</span><span class="o">=-</span><span class="mf">1e98</span><span class="p">)</span>
            <span class="c">#mmlab.pipeline.volume(src)</span>
            <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;x_axes&#39;</span><span class="p">)</span>
            <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;y_axes&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
        
    <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">S</span>

<span class="k">def</span> <span class="nf">_plot3d_dev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ynames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;psi&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">cbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Three dimensional plots. Data with xnames r,z will be plotted</span>
<span class="sd">    with third dimension phi where Y = Re[y]cos(n*phi)+Im[y]sin(n*phi).</span>

<span class="sd">        1D data &gt; lines in a plane in 3-space.</span>
<span class="sd">        2D data &gt; z axis becomes y value</span>
<span class="sd">        3D data &gt; chosen display type</span>

<span class="sd">    Must have mayavi.mlab module available in pythonpath.</span>
<span class="sd">    </span>
<span class="sd">    *Key Word Arguments:*</span>
<span class="sd">      ynames   : list. </span>
<span class="sd">        Strings specifying dependent data displayed.</span>
<span class="sd">      filter   : dict. </span>
<span class="sd">        Filter points as only those closest to this y value.</span>
<span class="sd">      plot_type : str. </span>
<span class="sd">        Valid mayavi.mlab function name. </span>
<span class="sd">        Overrides default function choices (plot3d,mesh,quiver3d).</span>

<span class="sd">    *Returns:*</span>
<span class="sd">      figure.</span>
<span class="sd">      </span>
<span class="sd">      </span>
<span class="sd">    *Example:*</span>
<span class="sd">    </span>
<span class="sd">    xb, = data.read(&#39;examples/DIIID_example/ipec_xbnormal_fun_n1.out&#39;,forcex=[&#39;r&#39;,&#39;z&#39;])</span>
<span class="sd">    xb.plot3d(&#39;bno&#39;)</span>
<span class="sd">    </span>
<span class="sd">    ..note: I think what we usually want out of IPEC is</span>
<span class="sd">    the 3D surface perturbation. If we run with fun_flag</span>
<span class="sd">    xn, = data.read(&#39;ipec_xbnormal_fun_n2.out&#39;)</span>
<span class="sd">    psi = 1.0</span>
<span class="sd">    n = 2</span>
<span class="sd">    fltr= xb.y[&#39;psi&#39;]==xb.y[&#39;psi&#39;][np.abs(xb.y[&#39;psi&#39;]-psi).argmin()]</span>
<span class="sd">    r,z,p = xb.pts[:,0][fltr],xb.pts[:,1][fltr],np.linspace(0,2*np.pi,60)</span>
<span class="sd">    s = xb.y[&#39;bno&#39;][fltr]</span>
<span class="sd">    cx = r.reshape(-1,1)*np.exp(1j*p.reshape(1,-1))</span>
<span class="sd">    X,Y = cx.real,cx.imag</span>
<span class="sd">    Z = z.reshape(-1,1)*np.ones_like(X)</span>
<span class="sd">    S = (s.reshape(-1,1)*np.exp(-n*1j*p.reshape(1,-1))).real</span>
<span class="sd">    mmlab.figure(fgcolor=(0, 0, 0), bgcolor=(1, 1, 1))</span>
<span class="sd">    mmlab.mesh(X, Y, Z, scalars=S) #, colormap=&#39;YlGnBu&#39;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ynames</span><span class="p">:</span> <span class="n">ynames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">ynames</span><span class="o">=</span><span class="p">[</span><span class="n">ynames</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mmlab</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;Unable to import mayavi.mlab.&quot;</span><span class="p">)</span>

    <span class="c"># the correct 3d plotting function</span>
    <span class="n">plotfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mmlab</span><span class="p">,[</span><span class="s">&#39;plot3d&#39;</span><span class="p">,</span><span class="s">&#39;mesh&#39;</span><span class="p">,</span><span class="s">&#39;quiver3d&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">plot_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot_type</span><span class="o">==</span><span class="s">&#39;volume&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">plotfunc</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_field</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="n">thr</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">low</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">)</span>
                <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">volume</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">thr</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;x_axes&#39;</span><span class="p">)</span>
                <span class="n">mmlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_cut_plane</span><span class="p">(</span><span class="n">thr</span><span class="p">,</span><span class="n">plane_orientation</span><span class="o">=</span><span class="s">&#39;y_axes&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotfunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mmlab</span><span class="p">,</span><span class="n">plot_type</span><span class="p">)</span>
            

    <span class="c"># filter data by other y variable</span>
    <span class="n">fltr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fltr</span><span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="nb">filter</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
    
    <span class="c"># general multidimensional axes</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[</span><span class="n">fltr</span><span class="p">,:])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="c"># Extra work to convert the cylindrical axes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
        <span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">fltr</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">fltr</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">XY</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">XY</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">XY</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot_type</span><span class="o">==</span><span class="s">&#39;volume&#39;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">XY</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">XY</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c"># display data</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">fltr</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xnames</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">plotfunc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mmlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span><span class="n">mmlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">]:</span>
            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">X</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;scalars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">X</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S</span><span class="p">)]</span>
        <span class="c">#print(np.array(XYZ).shape)</span>
        <span class="n">plotfunc</span><span class="p">(</span><span class="o">*</span><span class="n">XYZ</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">mmlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">XYZ</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, PPPL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>